(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{245:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("更新系统")]),t._m(1),a("p",[t._v("一次性安装多个")]),t._m(2),t._m(3),t._m(4),a("p",[t._v("linux 管理node 可以使用 [nvm]\n(https://github.com/creationix/nvm)")]),a("p",[t._v("方便管理和升价node.js 版本")]),a("p",[a("a",{attrs:{href:"https://github.com/creationix/nvm#install-script",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装指令"),a("OutboundLink")],1),a("code",[t._v("wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash")])]),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/Abaneo/article/details/72853513",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云服务器端口不通的解决办法-安全组的问题"),a("OutboundLink")],1)]),t._m(13),a("p",[a("a",{attrs:{href:"http://blog.51cto.com/superw/1943250",target:"_blank",rel:"noopener noreferrer"}},[t._v("本地文件上传到Linux服务器的几种方法"),a("OutboundLink")],1)]),a("p",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ubuntu  安装 Mongodb"),a("OutboundLink")],1)]),t._m(14),t._m(15),t._m(16),a("p",[t._v("在执行下列操作的时候， 其实就是在写入mongodb的源地地址 ，")]),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/39343682/sudo-service-mongod-start-mongod-unrecognized-service",target:"_blank",rel:"noopener noreferrer"}},[t._v("如果遇到这个问题"),a("OutboundLink")],1)]),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),a("p",[t._v("为mongodb数据库实现定时备份 --通过写定时脚本的方便")]),t._m(33),t._m(34),a("p",[t._v("appname.backup.sh")]),t._m(35),a("p",[t._v("-d 数据库\n-u 用户名\n-p 密码\n-o 指定输出文件夹")]),t._m(36),t._m(37),t._m(38),t._m(39),t._m(40),t._m(41),a("p",[t._v("可以查看七牛 "),a("a",{attrs:{href:"https://developer.qiniu.com/sdk#official-sdk",target:"_blank",rel:"noopener noreferrer"}},[t._v("SDK文档"),a("OutboundLink")],1),t._v(" ->node.js")]),t._m(42),t._m(43),t._m(44),a("p",[t._v("需要在同层目录下赞助 qiniu模块")]),t._m(45),t._m(46)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"搭建node-js-生成环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建node-js-生成环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 搭建node.js 生成环境")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("sudo")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("apt-get")]),this._v(" update\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v("  vim openssl build-essential libssl-dev "),a("span",{attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"安装，配置nodejs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装，配置nodejs","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装，配置nodejs")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"先安装-nvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#先安装-nvm","aria-hidden":"true"}},[this._v("#")]),this._v(" 先安装 nvm")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"通过nvm-安装制定版本的node-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过nvm-安装制定版本的node-js","aria-hidden":"true"}},[this._v("#")]),this._v(" 通过nvm 安装制定版本的node.js")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("nvm "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" v6.9.5\nnvm "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" v10.3.0\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{attrs:{class:"token comment"}},[t._v("#安装。。。")]),t._v("\n\n\nnvm use v6.9.5\nnvm "),a("span",{attrs:{class:"token function"}},[t._v("alias")]),t._v(" default v6.9.5\n\nnode -v  "),a("span",{attrs:{class:"token comment"}},[t._v("# 查看版本")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"淘宝镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#淘宝镜像","aria-hidden":"true"}},[this._v("#")]),this._v(" 淘宝镜像")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 更换为淘宝镜像")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" --registry"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("https://registry.npm.taobao.org "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" -g "),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" --registry"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("https://registry.npm.taobao.org "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" -g cnpm\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("#系统文件监控数目")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" fs.inotify.max_user_watches"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("525288 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("tee")]),t._v(" -a /etc/sysctl.conf "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" sysctl -p\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装常用工具包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装常用工具包","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装常用工具包")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("看需要吧\n"),s("code",[this._v("npm i pm2 webpack gulp grunt-cli -g")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"阿里云遇到的问题收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阿里云遇到的问题收集","aria-hidden":"true"}},[this._v("#")]),this._v(" 阿里云遇到的问题收集")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"阿里云有默认的安全规则-有点像iptable的作用-限制了端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阿里云有默认的安全规则-有点像iptable的作用-限制了端口","aria-hidden":"true"}},[this._v("#")]),this._v(" 阿里云有默认的安全规则  有点像iptable的作用 限制了端口")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"linux-安装mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-安装mongodb","aria-hidden":"true"}},[this._v("#")]),this._v(" linux 安装Mongodb")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("apt 安装不到？")]),this._v("\n如果是在阿里云的服务器 ，有时候肯能安装包有问题，可能与阿里云的镜像有关系\n只要进入 apt.conf 文件 将镜像配置用"),s("code",[this._v("#")]),this._v("注释掉")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("sudo vi /etc/apt/apt.conf\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("安装数据源慢")]),this._v("\n但这样在安装 mongodb源的时候就有点慢。。Ctrl-c 终止下载")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.6 multiverse"')]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/apt/sources.list.d/mongodb-org-3.6.list\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("sudo vi /etc/apt/sources.list.d/mongodb-org-3.6.list \n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("把里面的源强制修改为 阿里云下的服务器的源\n"),s("code",[this._v("https://repo.mongodb.org/apt.....")]),this._v(" =>"),s("code",[this._v("http://mirrors.aliyun.com/mongodb/apt")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在更新源 "),s("code",[this._v("sudo apt-get update")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("安装"),s("code",[this._v("suod apt-get install -y mongodb-org")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"开启服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 开启服务")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("sudo service mongodb start\n\ncat /var/log/mongodb/mongod.log  # 查看日志文件  确认\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("注意防火墙是否会禁了mongodb服务端口")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("sudo service mongod start : mongod: unrecognized service")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("If already you install the mongodb just uninstall based on mongodb config\nBefore going do all stuff first install mongodb server.\n"),s("code",[this._v("sudo apt install mongodb-server")]),this._v("\nThen continue to install what mongodb config suggest you.\nOnce done your mongodb configuration you can go\n"),s("code",[this._v("sudo service mongodb start")]),this._v("\nNote: Its not mongod its mongodb")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"关闭服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关闭服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 关闭服务")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("sudo service mongodb stop\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"修改mongodb默认端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改mongodb默认端口","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改mongodb默认端口")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("修改了端口，也需要修改防火墙的配置\n"),s("code",[this._v("/etc/mongodb.conf")]),this._v(" 文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("net:\n    port: 27017  "),s("span",{attrs:{class:"token comment"}},[this._v("# 修改端口")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"设置备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 设置备份")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"配置执行脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置执行脚本","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置执行脚本")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" backup \n"),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" backup\n"),a("span",{attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" appname \n\n\n\n"),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" \n"),a("span",{attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" tasks  "),a("span",{attrs:{class:"token comment"}},[t._v("# 把脚本都写到一个文件 方便管理")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" tasks\n"),a("span",{attrs:{class:"token function"}},[t._v("vi")]),t._v(" appname.backup.sh\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("#!/bin/sh\n\nbackUpFolder = /home/cdf/backup/appname\ndate_now=`data +%Y_%m_%d_%H%M`\nbackFileName = appname_$data_now\n\ncd $backUpFolder  # 备份目录\nmkdir -p $backFileName \nmongodump - h 127.0.0.1:19999 -d cc-datebase -u cc-backuper -p 123123123  -o $backFileName\n\ntar zcvf $backFileName.tar.gz $backFileName  # 压缩\nrm -rf $backFileName  # 去掉临时目录\n\n# 用户后面备份到七牛云\n# NODE_ENV = $backUpFolder@$backFileName   node/home/user/tasks/uploadQiNiu.js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"执行脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本","aria-hidden":"true"}},[this._v("#")]),this._v(" 执行脚本")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("cd  # 到根目录\nsudo sh ./tasks/appname.backup.sh\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"添加定时任务，定时执行备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加定时任务，定时执行备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加定时任务，定时执行备份")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("cd")]),this._v("\n"),s("span",{attrs:{class:"token function"}},[this._v("crontab")]),this._v(" -e "),s("span",{attrs:{class:"token comment"}},[this._v("# 启动系统nano编辑器")]),this._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# m h dom mon dow command")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#凌晨十一分的时候 自动执行")]),t._v("\n11 00 * * * sh /home/user/tasks/appname.backup.sh\n"),a("span",{attrs:{class:"token comment"}},[t._v("#2点的时候 自动执行")]),t._v("\n00 2 * * * sh /home/user/tasks/appname.backup.sh\n"),a("span",{attrs:{class:"token comment"}},[t._v("#5点的时候 自动执行")]),t._v("\n00 5 * * * sh /home/user/tasks/appname.backup.sh\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"上传备份到数据到七牛云"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传备份到数据到七牛云","aria-hidden":"true"}},[this._v("#")]),this._v(" 上传备份到数据到七牛云")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("env")]),this._v("的参数 在xxx.backup.sh 文件中添加下面代码进传递")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("NODE_ENV "),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v(" "),s("span",{attrs:{class:"token variable"}},[this._v("$backUpFolder@")]),s("span",{attrs:{class:"token variable"}},[this._v("$backFileName")]),this._v("   node/home/user/tasks/uploadQiNiu.js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("uploadQiNiu.js")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" qiniu\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" qiniu "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"qiniu"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" parts "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("split")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'@'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" file "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" parts"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),a("span",{attrs:{class:"token string"}},[t._v("'.tar.gz'")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" filePath "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" parts"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),a("span",{attrs:{class:"token string"}},[t._v("'/'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v("file\n"),a("span",{attrs:{class:"token comment"}},[t._v("//需要填写你的 Access Key 和 Secret Key")]),t._v("\nqiniu"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("ACCESS_KEY")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Access_Key'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nqiniu"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("SECRET_KEY")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Secret_Key'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//要上传的空间")]),t._v("\nbucket "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Bucket_Name'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//上传到七牛后保存的文件名")]),t._v("\nkey "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" file"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//构建上传策略函数")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("uptoken")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucket"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" putPolicy "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("qiniu"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rs"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PutPolicy")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucket"),a("span",{attrs:{class:"token operator"}},[t._v("+")]),a("span",{attrs:{class:"token string"}},[t._v('":"')]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" putPolicy"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("token")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//生成上传 Token")]),t._v("\ntoken "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("uptoken")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucket"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//要上传文件的本地路径")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// filePath = './ruby-logo.png'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//构造上传函数")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("uploadFile")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uptoken"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localFile"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" extra "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("qiniu"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PutExtra")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    qiniu"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("putFile")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uptoken"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localFile"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extra"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ret"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// 上传成功， 处理返回值")]),t._v("\n        console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ret"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ret"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ret"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistentId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("       \n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// 上传失败， 处理返回代码")]),t._v("\n        console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//调用uploadFile上传")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("uploadFile")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePath"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])}],!1,null,null,null);s.default=e.exports}}]);